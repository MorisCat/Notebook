# 等精度数字频率计的设计

## 实现原理

等精度测量的一个最大特点是测量的窗口时间不是一个固定值，而是一个与被测信号有关的值，**刚好是被测信号的整数倍**。在计数允许时间内，同时对标准信号和被测信号进行计数，再通过数学公式推导得到被测信号的频率。

频率单位是$hz$，即一秒内的周期数。可以数出单位时间内基准信号和待测信号各有多少个周期，从而可以得到频率。比如$1s$内待测信号有$N_A$个周期，基准信号有$N_B$个周期，基准信号频率为$f_0$,设待测频率为$f_x$​，则
$$
\begin{cases}
1=N_{A} \times f_{x} \\
1=N_{B} \times f_{0} 
\end{cases}
$$
联立，解得：
$$
f_{x}=\frac{N_{A}}{N_{B}} \times f_{0}
$$

### 时序图如下

![](https://i.loli.net/2021/10/14/SlPzWapBcErdQAo.png)

## 实现思路

### 实现流程

**门控信号1**靠基准时钟来计数，计数过程中门控信号1拉高，**门控信号2**检测到门控信号1拉高后，开始检测输入信号的上升沿，检测到输入信号的上升沿后，门控信号2拉高；门控信号1计数完成后拉低，门控信号2检测到门控信号1拉低后，开始检测输入信号上升沿，检测到输入信号上升沿后，门控信号2拉低。在门控信号1和2拉高的过程中对两个时钟经过的周期开始进行计数，在两个门控信号均拉低时，代入公式计算频率大小。

### always块大体功能

#### 第一个

以基准信号为时钟的普通的计数器，计数到一定大小$N_1$

#### 第二个

判断计数器的值是否达到一定大小而==拉高或拉低==门控信号1

#### 第三个

以“`posedge 输入信号`”为触发，触发时判断门控信号1==是否拉高或拉低==来决定==是否拉高或拉低==门控信号2

#### 第四个

在门控信号2拉高的前提下，以输入信号为时钟的计数器，计数输入信号的周期数$N_2$

#### 第五个

代入公式
$$
f_{x}=\frac{N_{2}}{N_{1}} \times f_{0}
$$
计算结果
